<!DOCTYPE html>
<html ng-app="vipApp">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>订单来了——会员管理</title>
    <link rel ="Shortcut Icon" href="/static/image/favicon.ico">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/jquery-ui.min.css">
    <link rel="stylesheet" href="/static/css/main.min.css">
    <script src="/static/js/app/dist/common.js"></script>
    <script src="/static/js/app/dist/manageVip/vip.js"></script>
</head>
<body ng-controller="itemsCtrl">
    <div class="container-manageVip">
        <ul class="restaurant-head-nav" style="margin-top: 20px">
            <li>
                <a class="active" href="/view/vip/vip.html">会员列表</a>
            </li>
            <li>
                <a href="/view/vip/setting.html">会员设置</a>
            </li>
        </ul>
        <div class="vip-top">
            <input style="width: 256px" type="text" class="vip-right dd-input" ng-model="$root.searchText" ng-keyup="filterSearch()" placeholder="搜索姓名/手机号/证件号/会员卡号">
            <img class="filter-img" ng-click="search()" src="//static.dingdandao.com/vipSearch.png">
        </div>
        <div style="display: flex;flex-direction: row-reverse; margin-top: 19px">
            <button style="margin-left: 6px" class="dd-btn dd-btn-primary" ng-click="addNewVip()">新增会员</button>
            <a ng-href="{{outPutExcel()}}"><button class="dd-btn dd-btn-primary">导出明细</button></a>
        </div>
        <div class="clearboth"></div>
        <div class="table-container">
            <table>
                <thead>
                    <tr ng-click="openDetail(item)">
                        <th style="width: 98px">姓名</th>
                        <th style="width: 130px">会员等级</th>
                        <th style="width: 216px">会员卡号</th>
                        <th style="width: 134px">手机号</th>
                        <th style="width: 152px">消费金额</th>
                        <th>证件号</th>
                        <th style="width: 146px">加入时间</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="item in dataItems">
                        <td ng-bind="item.name"></td>
                        <td ng-bind="item.levelName"></td>
                        <td ng-bind="item.vipCardNum"></td>
                        <td ng-bind="item.phone"></td>
                        <td ng-bind="item.totalConsume"></td>
                        <td>{{item.idCardNum}}<span class="idType" ng-if="item.idCardNum && (item.idCardType || item.idCardType ===0) ">{{getIdCardIcon(item.idCardType)}}</span></td>
                        <td ng-bind="item.createTime.split(' ')[0]"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="pagination-container">
            <span class="vip-left"><small>共计&nbsp;</small><span ng-bind="vipUserCount"></span>个会员</span>
            <pager page-count="getPageCount()" current-page="$root.currentPage" on-page-change="onPageChange()"></pager>
        </div>
    </div>
    <div id="newVipModal" class="modal fade" role="dialog" ng-controller="createVipCtrl">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="top-fixed">
                    <span class="dialog-close" ng-click="close()">&times;</span>
                </div>
                <div class="add-container">
                    <div class="vip-info">
                        <p class="dialog-mainTitle" ng-if="!modify">新增会员</p>
                        <p class="dialog-mainTitle" ng-if="modify">修改会员信息</p>
                        <p class="dialog-subTitle">基本信息</p>
                        <div class="vipInfo">
                            <p>
                                <span class="newVip">
                                    <img ng-if="!modify" src="//static.dingdandao.com/start.png">姓名</span>
                                <input ng-model="vip.name" ng-if="!modify" type="text" maxlength="16" >
                                <span class="modifyVip" ng-bind="vip.name" ng-if="modify"></span>
                            </p>
                            <span ng-if="!modify && hasSubmit && vip.name.length === 0" class="tip-name">必填字段</span>
                            <span ng-if="!modify && hasSubmit && vip.name.length === 1" class="tip-name">格式错误</span>
                            <p>
                                <span class="newVip"><img ng-if="!modify" src="//static.dingdandao.com/start.png">手机号</span>
                                <input ng-model="vip.phone" ng-if="!modify" type="text" maxlength="11" >
                                <span class="modifyVip" ng-bind="vip.phone" ng-if="modify"></span>
                            </p>
                            <span ng-if="!modify && hasSubmit && vip.phone.length === 0" class="tip-phone">必填字段</span>
                            <span ng-if="!modify && hasSubmit && vip.phone.length > 0 && vip.phone.length !== 11" class="tip-phone">格式错误</span>
                            <table class="single-line">
                                <tr>
                                    <td>
                                        <label><img ng-if="!modify" src="//static.dingdandao.com/start.png">会员等级</label>
                                        <div class="select1 gender-select">
                                            <span ng-style="!vip.levelName ? {color:'#ccc'} : ''" ng-if="!modify">{{vip.levelName  || '-会员等级-'}}</span>
                                            <div class="select1_options">
                                                <div class="oitem"
                                                     ng-click="changeLevel(level.vipLevelId, level.vipLevelName);$event.stopPropagation();"
                                                     ng-repeat="level in levels">{{level.vipLevelName}}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="identification">
                                        <label>证件号</label>
                                        <div class="select1 idcard-select">
                                            <span ng-if="!modify">{{idCardList[vip.idCardType].label  || '身份证'}}</span>
                                            <div class="select1_options">
                                                <div class="oitem"
                                                     ng-click="changeIdCard(idCard.key, idCard.label);$event.stopPropagation();"
                                                     ng-repeat="idCard in idCardList">{{idCard.label}}
                                                </div>
                                            </div>
                                        </div>
                                        <input ng-model="vip.idCardNum" ng-if="!modify" type="text" minlength="2" maxlength="18">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="birthday">
                                        <label>生日</label>
                                        <div ng-if="!modify" style="display: inline-block;">
                                            <datepicker placeholder="-年 月 日-" format-selected-date="vip.birthday"></datepicker>
                                        </div>
                                    </td>
                                    <td class="gender">
                                        <label>性别</label>
                                        <div class="select1 gender-select">
                                            <span ng-style="!genderList[vip.gender] ? {color:'#ccc'} : ''" ng-if="!modify">{{genderList[vip.gender].label  || '-性别-'}}</span>
                                            <div class="select1_options">
                                                <div class="oitem"
                                                     ng-click="changeGender(gender.key, gender.label);$event.stopPropagation();"
                                                     ng-repeat="gender in genderList">{{gender.label}}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                            <div class="formrow clearfloat">
                                <div class="slabel">地区</div>
                                <div class="scontent">
                                    <div class="selectBox small">
                                        <div ng-style="!vip.province ? {color:'#ccc'}: ''" class="item selected" style="border-right: none;">
                                            {{ vip.province || '-省'}}
                                        </div>
                                        <div class="toselect-container toselect-first">
                                            <div class="item toselect" ng-click="selectProvince($index)" ng-repeat="n in provinceItems">{{n}}</div>
                                        </div>
                                    </div>
                                    <div class="selectBox small">
                                        <div ng-style="!vip.city ? {color:'#ccc'}: ''" class="item selected" style="border-right: none; border-left: none;">
                                            {{ vip.city || '市'}}
                                        </div>
                                        <div class="toselect-container">
                                            <div class="item toselect" ng-click="selectCity($index)" ng-repeat="n in cityItems">{{n}}</div>
                                        </div>
                                    </div>
                                    <div class="selectBox small">
                                        <div ng-style="!vip.county ? {color:'#ccc'}: ''" class="item selected" style="border-left: none;">
                                            {{ vip.county || '区-'}}
                                            <span class="triangle"></span>
                                        </div>
                                        <div class="toselect-container toselect-last">
                                            <div class="item toselect toselect-last-item" ng-click="selectDistrict($index)" ng-repeat="n in districtItems">{{n}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p>
                                <span class="newVip">邮箱</span><input ng-if="!modify" ng-model="vip.email" type="text" minlength="2" maxlength="50" >
                            </p>
                            <span ng-if="vip.email && !mailFilter.test(vip.email) && hasSubmit && !modify" class="tip-email">邮箱格式错误</span>
                            <p>
                                <span class="newVip">创建渠道</span>
                                <input ng-if="!modify" ng-model="vip.vipChannel" type="text" minlength="2" maxlength="50" >
                            </p>
                            <p>
                                <span class="newVip">备注</span>
                                <textarea ng-if="!modify" ng-model="vip.remark" type="text" placeholder="-请填写描述-" maxlength="140" ></textarea>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="dialog-foot">
                    <button ng-if="!modify" class="vip-confirm" ng-click="createVip()">确定</button>
                    <button ng-if="modify" class="vip-confirm" ng-click="editVip()">确定</button>
                    <button class="vip-cancel btn-cancel" ng-click="close()">取消</button>
                </div>
            </div>
        </div>
    </div>
    <div id="removeVipModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="top-fixed">
                    <span class="dialog-close">&times;</span>
                </div>
                <div class="remove-container">
                    删除会员之后不可找回,您确定要删除吗?
                </div>
                <div class="foot-remove">
                    <button class="remove-confirm" ng-click="removeVip()">确定</button>
                    <button class="remove-cancel btn-cancel">取消</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>