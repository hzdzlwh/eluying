<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>易露云</title>
  <link rel="stylesheet" href="/eluyun/bower_components/bootstrap/dist/css/bootstrap.min.css">
  <!--[if lte IE 6]>
  <link rel="stylesheet" type="text/css" href="/eluyun/static/css/bootstrap-ie6.css">
  <link rel="stylesheet" type="text/css" href="/eluyun/static/css/ie.css">
  <![endif]-->
  <link rel="stylesheet" href="/eluyun/static/css/main.min.css">
  <script src="/eluyun/bower_components/jquery.min.js"></script>
  <script src="/eluyun/static/js/jquery.cookie.js"></script>
  <script src="/eluyun/static/js/jquery.validate.min.js"></script>
  <script src="/eluyun/static/js/validation.js"></script>
  <script src="/eluyun/static/js/ajaxurl.js"></script>
  <!--[if lte IE 9]>
  <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv-printshiv.js"></script>
  <![endif]-->
  <script src="/eluyun/static/js/bootstrap.min.js"></script>
  <!--[if lte IE 6]>
  <script type="text/javascript" src="/eluyun/static/js/bootstrap-ie.js"></script>
  <![endif]-->
  <script src="/eluyun/static/js/main.js"></script>
  <script src="/eluyun/static/js/app/category/food/food.js"></script>
</head>
<body>
  <!-- 新增餐饮 -->
  <div class="modal fade" role="dialog" id="createFood">
    <div class="modal-dialog modal-w626">
      <div class="modal-content clearfloat">
        <div class="createFood clearfloat">
          <form class="inputFiled">
            <h1>新增餐饮</h1>
            <h2>基本信息</h2>
            <ul>
              <li>
                <label for="createFoodName">餐饮名称</label>
                <input type="text" class="text" id="createFoodName" placeholder="用于展示给客户">
              </li>
              <li>
                <label for="createFoodShortName">简称</label>
                <input type="text" class="text" id="createFoodShortName" placeholder="用于自己管理">
              </li>
              <li>
                <label for="createFoodUnit">单位</label>
                <input type="text" class="text" id="createFoodUnit" placeholder="请填写单位">
              </li>
              <li>
                <label for="createFoodFitNum">适用人数</label>
                <input type="text" class="text" id="createFoodFitNum" placeholder="请填写纯数字">
              </li>
              <li>
                <label for="createFoodInventory">默认库存</label>
                <input type="text" class="text" id="createFoodInventory" placeholder="请填写纯数字">
              </li>
              <li>
                <label for="createFoodPrice">单价</label>
                <input type="text" class="text" id="createFoodPrice" placeholder="请填写纯数字">
              </li>
              <li>
                <label for="createFoodDescription">描述</label>
                <textarea name="description" id="createFoodDescription" placeholder="请填写描述"></textarea>
              </li>
            </ul>
          </form>
          <div class="footer">
            <button class="btn-cancel">取消</button>
            <button class="btn-ok" id="createFoodOk">确认</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 编辑基本信息 -->
  <div class="modal fade" role="dialog" id="editFood">
    <div class="modal-dialog modal-w626">
      <div class="modal-content clearfloat">
        <div class="editFood clearfloat">
          <form class="inputFiled">
            <h1>编辑餐饮</h1>
            <h2>基本信息</h2>
            <ul>
              <li>
                <label for="editFoodName">餐饮名称</label>
                <input id="editFoodName" type="text" class="text" placeholder="用于展示给客户">
              </li>
              <li>
                <label for="editFoodShortName">简称</label>
                <input id="editFoodShortName" type="text" class="text" placeholder="用于自己管理">
              </li>
              <li>
                <label for="editFoodUnit">单位</label>
                <input id="editFoodUnit" type="text" class="text" placeholder="请填写单位">
              </li>
              <li>
                <label for="editFoodFitNum">适用人数</label>
                <input id="editFoodFitNum" type="text" class="text" placeholder="请填写纯数字">
              </li>
              <li>
                <label for="editFoodInventory">默认库存</label>
                <input id="editFoodInventory" type="text" class="text" placeholder="请填写纯数字">
              </li>
              <li>
                <label for="editFoodPrice">单价</label>
                <input id="editFoodPrice" type="text" class="text" placeholder="请填写纯数字">
              </li>
              <li>
                <label for="editFoodDescription">描述</label>
                <textarea id="editFoodDescription" name="description" placeholder="请填写描述"></textarea>
              </li>
            </ul>
          </form>
          <div class="footer">
            <button class="btn-cancel">取消</button>
            <button class="btn-ok" id="editFoodOk">确定</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 编辑展示信息 -->
  <div class="modal fade" role="dialog" id="editDisplayInfo">
    <div class="modal-dialog modal-w626">
      <div class="modal-content clearfloat">
        <div class="editDisplayInfo clearfloat">
          <h1>编辑展示信息-烧烤</h1>
          <p class="tip">这些信息会出现在易露营的网站以及APP上，更详细的信息会帮助你吸引来更多客人哦</p>
          <div class="clearfloat">
            <div class="photo">
              <h2>图片管理</h2>
              <div class="cover">
                <div class="title clearfloat">
                  <span>封面</span>
                  <div class="create">
                    <img src="/eluyun/static/image/icon_xinjian.png" alt="新增">
                    <span>上传图片</span>
                  </div>
                </div>
                <div class="photoContainer">
                </div>
              </div>
              <div class="detail">
                <div class="title clearfloat">
                  <span>详细图片</span>
                  <div class="create">
                    <img src="/eluyun/static/image/icon_xinjian.png" alt="新增">
                    <span>上传图片</span>
                  </div>
                </div>
                <div class="photoContainer">
                </div>
              </div>
            </div>
            <div class="operate">
              <div class="first">
                <div class="operateItem">
                  <img src="/eluyun/static/image/icon_bianjijibenxinxi.png" alt="">
                  <p>替换图片</p>
                </div>
                <div class="operateItem">
                  <img src="/eluyun/static/image/icon_shanchu.png" alt="">
                  <p>删除</p>
                </div>
              </div>
              <div class="second">
                <div class="operateItem">
                  <img src="/eluyun/static/image/icon_bianjijibenxinxi.png" alt="">
                  <p>替换图片</p>
                </div>
                <div class="operateItem">
                  <img src="/eluyun/static/image/icon_shanchu.png" alt="">
                  <p>删除</p>
                </div>
              </div>
            </div>
          </div>
          <div class="footer">
            <button class="btn-cancel">取消</button>
            <button class="btn-ok">确认</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--页面主体 -->
  <div class="mainContainer">
    <div class="content">
      <div class="title">
        <span class="campName"></span>
        <div class="create" data-toggle="modal" data-target="#createFood">
          <img src="/eluyun/static/image/icon_xinjian.png" alt="新增">
          <span>新增餐饮</span>
        </div>
      </div>
      <div class="categoryGrid">
        <table>
          <thead>
          <tr class="head">
            <th>餐饮</th>
            <th>简称</th>
            <th>单位</th>
            <th>适用人数</th>
            <th>默认库存</th>
            <th>单价</th>
            <th>描述</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="operate">
        <div class="first clearfloat">
          <div class="operateItem hide">
            <div class="clickDiv" id="editFoodButton" data-toggle="modal" data-target="#editFood">
              <img src="/eluyun/static/image/icon_bianjijibenxinxi.png" alt="">
              <p>编辑基本信息</p>
            </div>
          </div>
          <div class="operateItem hide">
            <div class="clickDiv" id="deleteFoodButton">
              <img src="/eluyun/static/image/icon_shanchu.png" alt="">
              <p>删除</p>
            </div>
          </div>
        </div>
        <div class="second clearfloat hide">
          <div class="operateItem hide">
            <div class="clickDiv" id="editDisplayInfoButton" data-toggle="modal" data-target="#editDisplayInfo">
              <img src="/eluyun/static/image/icon_bianjijibenxinxi.png" alt="">
              <p>编辑展示信息</p>
            </div>
          </div>
          <div class="operateItem hide">
            <div class="clickDiv">
              <img src="/eluyun/static/image/icon_shangjia.png" alt="">
              <p>上架</p>
            </div>
            <p class="putaway">目前未上架</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    //列表对象
    var foodCategoryList = {};
    //渲染
    foodCategoryList.render = function(){
      var str = "";
      $.each(foodCategoryList.list, function(index, element){
        str += "<tr class='mainClass'>" +
                "<td>" + element.name + "</td>" +
                "<td>" + element.shortName + "</td>" +
                "<td>" + element.unit + "</td>" +
                "<td>" + element.fitNum + "</td>" +
                "<td>" + element.inventory + "</td>" +
                "<td>" + element.price + "</td>" +
                "<td>" + element.description + "</td>" +
                "<input type='hidden' value=" + element.id + " /></tr>";
      });
      $(".categoryGrid tbody").html(str);
      $(".operateItem").addClass("hide");
      $(".second").addClass("hide");
      $(".mainClass").on("click", function(){
        $(".mainClass").removeClass("mainActive");
        $(".subclass").removeClass("subActive");
        $(this).addClass("mainActive");
        $(".operateItem").removeClass("hide");
        $(".second").removeClass("hide");
      })
    };
    //判断空属性
    function emptyFilter(data){
      $.each(data, function(index, element){
        for (var name in element) {
          if (element[name] == null || element[name] == undefined) {
            element[name] = "";
          }
        }
      });
      return data;
    }
    //session失效验证
    function sessionValidate(data){
      if (data.code == 14) {
        location.href = "/eluyun/view/loginTest.html";
      }
    }
    //读取餐饮品类列表
    function loadFoodCategoryList(){
      $.ajax({
        url: host + pullOtherCategoryListUrl + ";jsessionid=" + $.cookie("jsessionid"),
        data: {type: 1},
        success: function(result){
          foodCategoryList.list = result.data.list;
          foodCategoryList.render();
        },
        dataFilter: function(result){
          result = JSON.parse(result);
          sessionValidate(result);
          result.data.list = emptyFilter(result.data.list);
          return JSON.stringify(result);
        }
      });
    }
    //添加
    function addFoodCategory(){
      var item = {
        name: $("#createFoodName").val(),
        shortName: $("#createFoodShortName").val(),
        unit: $("#createFoodUnit").val(),
        fitNum: $("#createFoodFitNum").val(),
        inventory: $("#createFoodInventory").val(),
        price: $("#createFoodPrice").val(),
        description: $("#createFoodDescription").val(),
        type: 1
      };
      $.ajax({
        url: host + addOrEditExtraCategoryUrl + ";jsessionid=" + $.cookie("jsessionid"),
        type: "POST",
        data: item,
        success: function(result){
          item.id = result.data.id;
          foodCategoryList.list.push(item);
          foodCategoryList.render();
        }
      })
    }
    //编辑基本信息
    function editFoodCategory(){
      var item = {
        id: $(".mainActive input").val(),
        name: $("#editFoodName").val(),
        shortName: $("#editFoodShortName").val(),
        unit: $("#editFoodUnit").val(),
        fitNum: $("#editFoodFitNum").val(),
        inventory: $("#editFoodInventory").val(),
        price: $("#editFoodPrice").val(),
        description: $("#editFoodDescription").val(),
        type: 1
      };
      $.ajax({
        url: host + addOrEditExtraCategoryUrl + ";jsessionid=" + $.cookie("jsessionid"),
        type: "POST",
        data: item,
        success: function(){
          $.each(foodCategoryList.list, function(index, element){
            if (element.id == item.id) {
              foodCategoryList.list[index] = item;
              return false; //等于break
            }
          });
          foodCategoryList.render();
        }
      });
    }
    //删除
    function deleteFoodCategory(){
      var id = $(".mainActive input").val();
      $.ajax({
        url: host + deleteOtherCategoryUrl + ";jsessionid=" + $.cookie("jsessionid"),
        data: {id: id},
        success: function(){
          $.each(foodCategoryList.list, function(index, element){
            if (element.id == id) {
              foodCategoryList.list.splice(index, 1);
              return false; //等于break
            }
          });
          foodCategoryList.render();
        }
      });
    }
    $(function(){
      $("form").validate();
      //读取营地名称和用户名
      $(".campName").html(localStorage.getItem("campName"));
      $(".userName").find("a").html(localStorage.getItem("userName"));
      loadFoodCategoryList();
    });
    $("#createFoodOk").on("click", function(){
      var that = this;
      addFoodCategory();
      clearModal(that);
    });
    $("#editFoodOk").on("click", function(){
      var that = this;
      editFoodCategory();
      clearModal(that);
    });
    $("#editFoodButton").on("click", function(){
      $("#editFoodName").val($(".mainActive td:eq(0)").html());
      $("#editFoodShortName").val($(".mainActive td:eq(1)").html());
      $("#editFoodUnit").val($(".mainActive td:eq(2)").html());
      $("#editFoodFitNum").val($(".mainActive td:eq(3)").html());
      $("#editFoodInventory").val($(".mainActive td:eq(4)").html());
      $("#editFoodPrice").val($(".mainActive td:eq(5)").html());
      $("#editFoodDescription").val($(".mainActive td:eq(6)").html());
    });
    $("#deleteFoodButton").on("click", function(){
      confirmCallback = deleteFoodCategory;
      dialogConfig = {title:"提示", message:"您确定要删除吗？"};
      confirmDialog(dialogConfig,confirmCallback);
    })
  </script>
</body>
</html>